{
  "Id": 14,
  "Name": "The Horror",
  "UserPrompt": "Make a shadow figure that very slowly teleports behind and follows yous, when you look at it, it should get aggressive and chase and damage you, darken the screen with a motion blur effect",
  "ExecutionCode": "local ply = Entity(1)\n\n-- Clean up any existing shadow\nif IsValid(_G.ShadowFigure) then _G.ShadowFigure:Remove() end\ntimer.Remove(\u0022ShadowFollow\u0022)\ntimer.Remove(\u0022ShadowLookCheck\u0022)\ntimer.Remove(\u0022ShadowChase\u0022)\n_G.ShadowActive = false\n_G.ShadowAggressive = false\n\n-- Create the shadow figure\nlocal shadow = ents.Create(\u0022prop_dynamic\u0022)\nshadow:SetModel(\u0022models/player/corpse1.mdl\u0022)\nshadow:SetPos(ply:GetPos() - ply:GetForward() * 400 \u002B Vector(0,0,20))\nshadow:Spawn()\nshadow:SetColor(Color(0,0,0,255))\nshadow:SetRenderMode(RENDERMODE_TRANSCOLOR)\nshadow:SetMaterial(\u0022models/debug/debugwhite\u0022)\n\n_G.ShadowFigure = shadow\n_G.ShadowActive = true\n_G.ShadowAggressive = false\n_G.ShadowLastSeenTime = 0\n\n-- Slow teleport behind player when passive\ntimer.Create(\u0022ShadowFollow\u0022, math.Rand(4, 8), 0, function()\n    if not _G.ShadowActive or not IsValid(_G.ShadowFigure) or not IsValid(ply) then return end\n    if _G.ShadowAggressive then return end\n    \n    -- Always spawn BEHIND the player\n    local behindAngle = ply:EyeAngles().y \u002B 180 \u002B math.random(-45, 45)\n    local angles = Angle(0, behindAngle, 0)\n    local dist = math.random(200, 400)\n    local newPos = ply:GetPos() \u002B angles:Forward() * dist\n    \n    local tr = util.TraceLine({start = newPos \u002B Vector(0,0,100), endpos = newPos - Vector(0,0,200), mask = MASK_SOLID_BRUSHONLY})\n    if tr.Hit then newPos = tr.HitPos \u002B Vector(0,0,5) end\n    \n    _G.ShadowFigure:SetNoDraw(true)\n    timer.Simple(0.1, function()\n        if IsValid(_G.ShadowFigure) then\n            _G.ShadowFigure:SetPos(newPos)\n            _G.ShadowFigure:SetAngles(Angle(0, (ply:GetPos() - newPos):Angle().y, 0))\n            _G.ShadowFigure:SetNoDraw(false)\n            ply:EmitSound(\u0022ambient/atmosphere/cave_hit\u0022 .. math.random(1,6) .. \u0022.wav\u0022, 40, math.random(30,50))\n        end\n    end)\n    \n    timer.Adjust(\u0022ShadowFollow\u0022, math.Rand(5, 10), 0)\nend)\n\n-- Check if player is looking at shadow\ntimer.Create(\u0022ShadowLookCheck\u0022, 0.05, 0, function()\n    if not _G.ShadowActive or not IsValid(_G.ShadowFigure) or not IsValid(ply) then return end\n    \n    local eyePos = ply:EyePos()\n    local eyeDir = ply:EyeAngles():Forward()\n    local toShadow = (_G.ShadowFigure:GetPos() \u002B Vector(0,0,40) - eyePos):GetNormalized()\n    local dot = eyeDir:Dot(toShadow)\n    local dist = eyePos:Distance(_G.ShadowFigure:GetPos())\n    \n    local tr = util.TraceLine({start = eyePos, endpos = _G.ShadowFigure:GetPos() \u002B Vector(0,0,40), filter = ply})\n    local canSee = (tr.Entity == _G.ShadowFigure or not tr.Hit or tr.Fraction \u003E 0.9)\n    \n    -- Player is looking at the shadow!\n    if dot \u003E 0.7 and canSee and dist \u003C 1500 then\n        _G.ShadowLastSeenTime = CurTime()\n        \n        if not _G.ShadowAggressive then\n            _G.ShadowAggressive = true\n            ply:EmitSound(\u0022npc/stalker/go_alert2a.wav\u0022, 90, math.random(60,80))\n            \n            -- Start aggressive chase\n            timer.Create(\u0022ShadowChase\u0022, 0.05, 0, function()\n                if not _G.ShadowActive or not IsValid(_G.ShadowFigure) or not IsValid(ply) then return end\n                if not _G.ShadowAggressive then return end\n                \n                local targetPos = ply:GetPos()\n                local currentPos = _G.ShadowFigure:GetPos()\n                local moveDir = (targetPos - currentPos):GetNormalized()\n                local newPos = currentPos \u002B moveDir * 15\n                \n                local groundTr = util.TraceLine({start = newPos \u002B Vector(0,0,50), endpos = newPos - Vector(0,0,100), mask = MASK_SOLID_BRUSHONLY})\n                if groundTr.Hit then newPos = groundTr.HitPos \u002B Vector(0,0,5) end\n                \n                _G.ShadowFigure:SetPos(newPos)\n                _G.ShadowFigure:SetAngles(Angle(0, (targetPos - newPos):Angle().y, 0))\n                \n                -- Damage if close\n                if currentPos:Distance(targetPos) \u003C 80 then\n                    ply:TakeDamage(5, _G.ShadowFigure, _G.ShadowFigure)\n                    ply:EmitSound(\u0022ambient/levels/prison/radio_random\u0022 .. math.random(1,9) .. \u0022.wav\u0022, 70, math.random(30,50))\n                    \n                    -- Push player\n                    ply:SetVelocity((ply:GetPos() - currentPos):GetNormalized() * 200 \u002B Vector(0,0,100))\n                end\n            end)\n        end\n        \n        -- Darken screen with motion blur when looking\n        RunOnClient([=[\n            if not _G.ShadowDarkness then _G.ShadowDarkness = 0 end\n            if not _G.ShadowBlur then _G.ShadowBlur = 0 end\n            \n            _G.ShadowDarkness = math.Clamp(_G.ShadowDarkness \u002B 8, 0, 200)\n            _G.ShadowBlur = math.Clamp(_G.ShadowBlur \u002B 0.15, 0, 1)\n            \n            hook.Add(\u0022RenderScreenspaceEffects\u0022, \u0022ShadowMotionBlur\u0022, function()\n                if _G.ShadowBlur and _G.ShadowBlur \u003E 0.01 then\n                    DrawMotionBlur(0.1, _G.ShadowBlur, 0.01)\n                end\n            end)\n            \n            hook.Add(\u0022HUDPaint\u0022, \u0022ShadowDarkOverlay\u0022, function()\n                if _G.ShadowDarkness and _G.ShadowDarkness \u003E 0 then\n                    surface.SetDrawColor(0, 0, 0, _G.ShadowDarkness)\n                    surface.DrawRect(0, 0, ScrW(), ScrH())\n                    \n                    -- Creepy red static\n                    for i = 1, math.floor(_G.ShadowDarkness / 20) do\n                        surface.SetDrawColor(30, 0, 0, math.random(30, 80))\n                        local x, y = math.random(0, ScrW()), math.random(0, ScrH())\n                        surface.DrawRect(x, y, math.random(50, 300), math.random(1, 4))\n                    end\n                    \n                    -- Vignette effect\n                    local vignetteAlpha = _G.ShadowDarkness * 0.8\n                    surface.SetDrawColor(0, 0, 0, vignetteAlpha)\n                    for i = 1, 20 do\n                        local inset = i * 30\n                        surface.DrawOutlinedRect(inset, inset, ScrW() - inset*2, ScrH() - inset*2, 15)\n                    end\n                end\n            end)\n            \n            util.ScreenShake(Vector(0,0,0), 3, 8, 0.2, 0)\n        ]=])\n    else\n        -- Slowly calm down if not looking\n        if _G.ShadowAggressive and CurTime() - _G.ShadowLastSeenTime \u003E 3 then\n            _G.ShadowAggressive = false\n            timer.Remove(\u0022ShadowChase\u0022)\n            ply:EmitSound(\u0022ambient/atmosphere/terrain_rumble1.wav\u0022, 50, 40)\n        end\n        \n        -- Decay screen effects\n        RunOnClient([=[\n            if _G.ShadowDarkness then _G.ShadowDarkness = math.max(0, _G.ShadowDarkness - 1) end\n            if _G.ShadowBlur then _G.ShadowBlur = math.max(0, _G.ShadowBlur - 0.01) end\n        ]=])\n    end\nend)\n\n-- Ambient creepy sounds\ntimer.Create(\u0022ShadowAmbience\u0022, 5, 0, function()\n    if not _G.ShadowActive or not IsValid(ply) then return end\n    local sounds = {\u0022ambient/levels/canals/toxic_slime_gurgle3.wav\u0022, \u0022ambient/levels/prison/radio_random1.wav\u0022, \u0022ambient/atmosphere/cave_hit5.wav\u0022}\n    ply:EmitSound(sounds[math.random(#sounds)], 30, math.random(30, 60))\nend)\n\n-- End after 60 seconds\ntimer.Simple(60, function()\n    _G.ShadowActive = false\n    _G.ShadowAggressive = false\n    timer.Remove(\u0022ShadowFollow\u0022)\n    timer.Remove(\u0022ShadowLookCheck\u0022)\n    timer.Remove(\u0022ShadowChase\u0022)\n    timer.Remove(\u0022ShadowAmbience\u0022)\n    if IsValid(_G.ShadowFigure) then _G.ShadowFigure:Remove() end\n    RunOnClient([=[\n        hook.Remove(\u0022HUDPaint\u0022, \u0022ShadowDarkOverlay\u0022)\n        hook.Remove(\u0022RenderScreenspaceEffects\u0022, \u0022ShadowMotionBlur\u0022)\n        _G.ShadowDarkness = nil\n        _G.ShadowBlur = nil\n    ]=])\nend)",
  "UndoCode": "_G.ShadowActive = false\n_G.ShadowAggressive = false\ntimer.Remove(\u0022ShadowFollow\u0022)\ntimer.Remove(\u0022ShadowLookCheck\u0022)\ntimer.Remove(\u0022ShadowChase\u0022)\ntimer.Remove(\u0022ShadowAmbience\u0022)\nif IsValid(_G.ShadowFigure) then _G.ShadowFigure:Remove() end\n_G.ShadowFigure = nil\n_G.ShadowLastSeenTime = nil\nRunOnClient([=[\n    hook.Remove(\u0022HUDPaint\u0022, \u0022ShadowDarkOverlay\u0022)\n    hook.Remove(\u0022RenderScreenspaceEffects\u0022, \u0022ShadowMotionBlur\u0022)\n    _G.ShadowDarkness = nil\n    _G.ShadowBlur = nil\n]=])",
  "Category": "Threatening",
  "Description": null,
  "SavedAt": "2025-12-16T04:20:54.1426958Z",
  "OriginalCommandId": 278,
  "IsBuiltIn": true,
  "Variations": []
}