{
  "Id": 12,
  "Name": "360 No Scope",
  "UserPrompt": "Swap the player to their crossbow (give one to them if they don\u0027t have it), find a nearby enemy within atleast 512 units (or just spawn a combine soldier if there isn\u0027t one), make the player do a 360 then no scope onto the npc and shoot the crossbow at them.",
  "ExecutionCode": "local ply = Entity(1)\nif not IsValid(ply) then return end\n\n-- Give crossbow if they don\u0027t have it\nif not ply:HasWeapon(\u0022weapon_crossbow\u0022) then\n    ply:Give(\u0022weapon_crossbow\u0022)\nend\nply:SelectWeapon(\u0022weapon_crossbow\u0022)\n\n-- Find nearby enemy or spawn one\nlocal target = nil\nfor _, ent in pairs(ents.FindInSphere(ply:GetPos(), 512)) do\n    if IsValid(ent) and ent:IsNPC() and ent:Health() \u003E 0 then\n        local disp = ent:Disposition(ply)\n        if disp == D_HT or disp == D_FR then\n            target = ent\n            break\n        end\n    end\nend\n\nif not IsValid(target) then\n    target = ents.Create(\u0022npc_combine_s\u0022)\n    target:SetPos(ply:GetPos() \u002B ply:GetForward() * 300 \u002B Vector(0, 0, 10))\n    target:Spawn()\n    target:Activate()\nend\n\n-- Store original angles\nlocal originalAng = ply:EyeAngles()\nlocal targetPos = target:GetPos() \u002B Vector(0, 0, 50)\n\n-- Do the 360 noscope\nlocal spinTime = 0.5\nlocal spinSteps = 30\nlocal currentStep = 0\n\ntimer.Create(\u0022360_spin_\u0022 .. CurTime(), spinTime / spinSteps, spinSteps, function()\n    if not IsValid(ply) or not IsValid(target) then return end\n    currentStep = currentStep \u002B 1\n    \n    local progress = currentStep / spinSteps\n    local spinProgress = math.min(progress * 1.2, 1) -- Spin faster at start\n    \n    -- Calculate spin angle (360 degrees)\n    local spinYaw = originalAng.y \u002B (360 * spinProgress)\n    \n    -- On last few frames, snap to target\n    if progress \u003E 0.8 then\n        local aimDir = (target:GetPos() \u002B Vector(0, 0, 50) - ply:GetShootPos()):Angle()\n        local blendFactor = (progress - 0.8) / 0.2\n        spinYaw = Lerp(blendFactor, spinYaw, aimDir.y)\n        local finalAng = Angle(Lerp(blendFactor, originalAng.p, aimDir.p), spinYaw, 0)\n        ply:SetEyeAngles(finalAng)\n    else\n        ply:SetEyeAngles(Angle(originalAng.p, spinYaw, 0))\n    end\nend)\n\n-- Fire the crossbow after spin completes\ntimer.Simple(spinTime \u002B 0.1, function()\n    if not IsValid(ply) or not IsValid(target) then return end\n    \n    -- Aim directly at target\n    local aimDir = (target:GetPos() \u002B Vector(0, 0, 50) - ply:GetShootPos()):Angle()\n    ply:SetEyeAngles(aimDir)\n    \n    -- Fire using console command (works reliably)\n    ply:ConCommand(\u0022\u002Battack\u0022)\n    timer.Simple(0.1, function()\n        if IsValid(ply) then\n            ply:ConCommand(\u0022-attack\u0022)\n        end\n    end)\nend)\n\n-- Play quickscope sound\ntimer.Simple(spinTime, function()\n    if IsValid(ply) then\n        ply:EmitSound(\u0022weapons/crossbow/bolt_fly4.wav\u0022, 75, 100)\n    end\nend)\n\n-- MLG effects on client\nRunOnClient([=[\n    -- Screen flash\n    timer.Simple(0.5, function()\n        local flash = vgui.Create(\u0022DPanel\u0022)\n        flash:SetSize(ScrW(), ScrH())\n        flash:SetPos(0, 0)\n        flash.Paint = function(s, w, h)\n            surface.SetDrawColor(255, 255, 255, 200)\n            surface.DrawRect(0, 0, w, h)\n        end\n        timer.Simple(0.05, function()\n            if IsValid(flash) then flash:Remove() end\n        end)\n    end)\n    \n    -- Play hit sound\n    timer.Simple(0.65, function()\n        surface.PlaySound(\u0022buttons/button14.wav\u0022)\n    end)\n]=])",
  "UndoCode": "timer.Remove(\u0022360_spin_\u0022 .. CurTime())\nlocal ply = Entity(1)\nif IsValid(ply) then\n    ply:ConCommand(\u0022-attack\u0022)\nend",
  "Category": "Dumb",
  "Description": null,
  "SavedAt": "2025-12-16T04:05:37.5337112Z",
  "OriginalCommandId": 267,
  "IsBuiltIn": true
}