{
  "Id": 18,
  "Name": "Spawn fast zombies behind upcoming corners",
  "UserPrompt": "find places in the player\u0027s view cone that aren\u0027t directly visible by line of sight, and spawn fast zombies in those places to charge at the player. Or do any other method of finding non visible areas in the field of view to spawn them behind, as long as you make sure they arent out of bounds. You might have to manually nudge them to walk out of behind whereever they are (scripted sequence or another method idk) and see the player, else they won\u0027t charge.\n",
  "ExecutionCode": "local ply = Entity(1)\nif not IsValid(ply) then return end\n\nlocal spawned = {}\nlocal eyePos = ply:EyePos()\nlocal eyeAng = ply:EyeAngles()\nlocal forward = eyeAng:Forward()\n\nlocal function IsInFOV(pos)\n    local dir = (pos - eyePos):GetNormalized()\n    local dot = forward:Dot(dir)\n    return dot \u003E 0.5\nend\n\nlocal function FindHiddenSpots()\n    local spots = {}\n    local checkDist = 800\n    \n    for i = 1, 40 do\n        local ang = Angle(math.random(-30, 30), eyeAng.y \u002B math.random(-60, 60), 0)\n        local dir = ang:Forward()\n        local targetPos = eyePos \u002B dir * checkDist\n        \n        local tr = util.TraceLine({\n            start = eyePos,\n            endpos = targetPos,\n            filter = ply,\n            mask = MASK_SOLID_BRUSHONLY\n        })\n        \n        if tr.Hit and tr.HitPos:Distance(eyePos) \u003E 200 then\n            local wallNormal = tr.HitNormal\n            local behindWall = tr.HitPos \u002B wallNormal * -80\n            \n            local groundTr = util.TraceLine({\n                start = behindWall \u002B Vector(0,0,50),\n                endpos = behindWall - Vector(0,0,200),\n                mask = MASK_SOLID_BRUSHONLY\n            })\n            \n            if groundTr.Hit and not groundTr.HitSky then\n                local spawnPos = groundTr.HitPos \u002B Vector(0,0,10)\n                \n                local checkTr = util.TraceLine({\n                    start = eyePos,\n                    endpos = spawnPos \u002B Vector(0,0,40),\n                    filter = ply,\n                    mask = MASK_SOLID_BRUSHONLY\n                })\n                \n                if checkTr.Hit and checkTr.Fraction \u003C 0.95 then\n                    local hullTr = util.TraceHull({\n                        start = spawnPos,\n                        endpos = spawnPos,\n                        mins = Vector(-16,-16,0),\n                        maxs = Vector(16,16,72),\n                        mask = MASK_NPCSOLID\n                    })\n                    \n                    if not hullTr.Hit then\n                        table.insert(spots, {pos = spawnPos, exitDir = wallNormal})\n                    end\n                end\n            end\n        end\n    end\n    \n    return spots\nend\n\nlocal spots = FindHiddenSpots()\n\nlocal spawnCount = math.min(#spots, 4)\nfor i = 1, spawnCount do\n    local spot = spots[i]\n    \n    local zombie = ents.Create(\u0022npc_fastzombie\u0022)\n    if IsValid(zombie) then\n        zombie:SetPos(spot.pos)\n        zombie:SetAngles(Angle(0, (ply:GetPos() - spot.pos):Angle().y, 0))\n        zombie:Spawn()\n        zombie:Activate()\n        \n        table.insert(spawned, zombie)\n        \n        timer.Simple(0.3 \u002B i * 0.2, function()\n            if IsValid(zombie) and IsValid(ply) then\n                local exitPos = spot.pos \u002B spot.exitDir * 150\n                \n                zombie:SetLastPosition(exitPos)\n                zombie:SetSchedule(SCHED_FORCED_GO_RUN)\n                \n                timer.Simple(0.8, function()\n                    if IsValid(zombie) and IsValid(ply) then\n                        zombie:SetEnemy(ply)\n                        zombie:SetSchedule(SCHED_CHASE_ENEMY)\n                        zombie:AlertSound()\n                    end\n                end)\n            end\n        end)\n    end\nend\n\nif spawnCount == 0 then\n    for i = 1, 3 do\n        local offset = Vector(math.random(-300, 300), math.random(-300, 300), 0)\n        local behindPos = ply:GetPos() - forward * 400 \u002B offset\n        \n        local groundTr = util.TraceLine({\n            start = behindPos \u002B Vector(0,0,100),\n            endpos = behindPos - Vector(0,0,200),\n            mask = MASK_SOLID_BRUSHONLY\n        })\n        \n        if groundTr.Hit then\n            local zombie = ents.Create(\u0022npc_fastzombie\u0022)\n            if IsValid(zombie) then\n                zombie:SetPos(groundTr.HitPos \u002B Vector(0,0,10))\n                zombie:Spawn()\n                zombie:Activate()\n                table.insert(spawned, zombie)\n                \n                timer.Simple(0.5, function()\n                    if IsValid(zombie) and IsValid(ply) then\n                        zombie:SetEnemy(ply)\n                        zombie:SetSchedule(SCHED_CHASE_ENEMY)\n                    end\n                end)\n            end\n        end\n    end\nend\n\nAIChaos_HiddenZombies = spawned\n\ntimer.Simple(45, function()\n    for _, z in ipairs(AIChaos_HiddenZombies or {}) do\n        if IsValid(z) then z:Remove() end\n    end\nend)",
  "UndoCode": "for _, z in ipairs(AIChaos_HiddenZombies or {}) do\n    if IsValid(z) then z:Remove() end\nend\nAIChaos_HiddenZombies = nil",
  "Category": "Threatening",
  "Description": null,
  "SavedAt": "2025-12-16T19:35:28.2390933Z",
  "OriginalCommandId": 352,
  "IsBuiltIn": true,
  "Variations": []
}